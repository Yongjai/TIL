## Fragmentation

이번에 알아볼 내용은 파편화에 관한 내용입니다. 사실 iOS보단 안드로이드에서 많이 거론되는 문제입니다.

파편화의 종류는 크게 3가지로 나눌 수 있습니다.

- OS
- Size
- Device

#### OS

iOS를 사용하면 사람마다 사용하는 OS 버전이 다를 수 있습니다. 누구는 iOS 9 버전을 쓰고, 누구는 iOS 10을 사용하고… 베타버전을 사용하는 사람도 있겠죠. 이것이 문제가 되는 이유는 OS마다 지원하는 API, Device가 다르다는 점입니다. 예를 들어, iOS 9에서 사용가능한 API인 3d Touch와 Search API를 iOS 8에서는 사용이 불가능합니다. 그리고 Deprecated되는 API들도 존재합니다. 예를 들면, NSURLConnection으로 사용했던 것이 이제는 NSURLSession을 사용해야 합니다. 이처럼 OS가 다르면 OS에 따라 파편화 현상이 발생하게 됩니다.

#### Size

아이폰의 종류에 따라 생기는 문제입니다. 화면의 크기가 기기마다 다르고, 레티나 디스플레이의 지원 여부에 따라 문제가 발생하기 때문입니다. 화면마다 크기가 다르기 때문에 AutoLayout 같은 기능을 이용해서 기기마다 다른 사이즈에 적절하게 대응을 해줘야 합니다. 또한 레티나 디스플레이 지원 여부에 따라 Asset의 1x, 2x, 3x를 나눠서 모두 지원해줘야 합니다.

#### Device

사실 위의 문제들은 기기가 다르기 때문에 발생하는 문제라고 볼 수 있습니다. 기기마다 지원해줄 수 있는 최대의 OS가 다르고, 화면의 크기가 다르고, 하드웨어의 구성이 다르기 때문에 파편화 문제가 발생합니다. 만약 모든 기기의 크기, 구성, 성능이 같다면 파편화 문제는 발생하지 않을 것입니다.

#### 대응 방법

그렇다면 어떻게 파편화 문제에 대해 대응할 수 있을까에 대해 알아봐야 합니다. 기본적으로 API가 사용이 가능한지에 대한 체크가 필요합니다. 애플에서는 iOS 버전에 따라 사용할 수 있는 API 목록과 화면의 크기도 세세하게 제공하고 있습니다. 이를 보고 현재 OS 버전을 체크하는 코드와 OS 버전에 따라 사용하는 API를 다르게 제공해서 파편화 문제를 해결해야 합니다. 화면 크기에 대한 파편화 문제는 autolayout과 같은 기능을 이용해서 해결할 수 있습니다.



API가 존재 여부에 따라 파편화를 해결할 수 있습니다. 그 존재 여부를 알 수 있는 코드는 다음과 같습니다.

````objective-c
// API의 존재유무를 확인하는 코드

if ([someclass class]) {
	// 해당 API가 존재하면 동작
} else {
  	// 다른 API를 쓰게 함.
}
````

하지만 API의 존재를 가지고 코드를 작성하는 것은 매우 비효율적이라고 생각됩니다. 따라서 API를 확인하는 것보단 OS를 확인하는 것이 좋은 방법입니다. OS 버전에 따라 어떤 API가 제공되는지를 알고 있다면 위의 코드와 같은 방식으로 API의 존재를 확인할 필요가 없습니다.

다음은 OS 버전을 확인할 수 있는 코드입니다.

````objective-c
// OS 버전을 확인하는 코드 

float ver = [[[UIDevice currentDevice] systemVersion] floatValue];

if (ver >= 8.0) {
    // 8.0 버전 이상에서 동작
} else {
  // 8.0 버전 미만에서 동작
}
````

위의 코드 한 줄로 해당 기기의 OS 버전을 알아낼 수 있고 그 버전이 뭐냐에 따라 알아서 처리를 해줄 수 있습니다.



[https://david-smith.org/iosversionstats/](https://david-smith.org/iosversionstats/) 

위 사이트를 참조하면 iOS 파편화 수치에 대한 정보를 알아낼 수 있습니다. 어떤 OS를 많이 사용하고 어떤 기기를 많이 사용하는지 등에 대해 %단위로 잘 보여주고 있습니다. 

